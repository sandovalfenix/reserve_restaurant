!function(e) {
    "use strict";
    e(document).ready(function() {
        $.get("/reserver/read", function(dataEvent) {
            e("#m-scheduler-calendar").fullCalendar({
                header: {
                    left: "month,basicWeek,basicDay", 
                    center: "prev,title,next", 
                    right: ""
                }, 
                navLinks:!0, 
                editable:!0, 
                selectable:!0, 
                selectHelper:!0, 
                eventLimit:!0, 
                columnFormat:"dddd",
                events: JSON.parse(dataEvent),
                eventRender: function(t, o) {
                    var i = e("<span/>").addClass("m-scheduler__event-type m-scheduler__event-type--"+t.type.toLowerCase()).text(t.typeTitle), 
                        n=moment(t.start).format("DD MMMM - h:mm a");
                    o.find(".fc-time").remove(), o.find(".fc-content").prepend(i), 
                    o.popover({
                        title: 'Reserva Realizada<span class="h5"><a href="javascript:void(0)" data-idEditModal='+t.id+' data-toggle="modal" data-target="#modalReserver" title="Editar" class="text-warning fas fa-edit"></a> | <a href="javascript:void(0)" data-idRemoveModal='+t.id+' data-toggle="modal" data-target="#deletedEvent" title="Eliminar" class="text-danger fas fa-trash"></a></span>',
                        html: 
                            true, 
                            content:'<div class="m-scheduler__event-heading pt-3">'+i.get(0).outerHTML+
                                        '<span class="m-scheduler__event-title">'+t.title+'</span>'+
                                    '</div>'+
                                    '<div class="m-scheduler__event-time text-center">'+
                                        '<b>Día</b>: '+n+''+
                                    '</div>'+
                                    '<div class="m-scheduler__event-desc">'+
                                    '<ul class="list-group">'+
                                      '<li class="list-group-item"><i class="fas fa-phone"></i> Teléfono: <a href="//wa.me/57'+t.phone+'&text=Su reserva fue aceptada&source=&data="><b>'+t.phone+'</b></a></li>'+
                                      '<li class="list-group-item"><i class="fas fa-envelope"></i> Correo: <a href="mailto:'+t.email+'"><b>'+t.email+'</b></a></li>'+
                                       '<li class="list-group-item"><i class="fas fa-users"></i> Nº Personas: <b>'+t.numPerson+'</b></li>'+
                                       '<li class="list-group-item"><i class="fas fa-utensils"></i> Mesa: <b>'+t.table+'</b></li>'+
                                    '</ul>'+
                                    '</div>', 
                            container: ".m-scheduler"
                    }), 
                    o.on("show.bs.popover", function() {
                        e(".popover.show").not(o).popover("hide")
                    })
                }, 
                eventClick:function(e, t, o) {}
            }),
            e(document).on("click", function(t) {
                !e("#m-scheduler-calendar").length||e(t.target).closest(".popover").length||e(t.target).closest(".fc-day-grid-event").length||e(".popover.show").popover("hide")
                $('a[data-idEditModal]').on('click', function() {
                    $.ajax({
                        url: '/reserver/editForm/'+$(this).attr('data-idEditModal'),
                        type: 'POST',
                    })
                    .done(function(data) {                 
                        $('#modalReserver').html(data);                    
                        $('form').attr('action','/reserver/update');
                        $('[data-dismiss="modal"]').on('click',function() {
                            location.reload();
                        });
                    })
                    .fail(function() {
                        console.log("error");
                    })
                    .always(function() {
                        console.log("complete");
                    });                
                });
                
                $('a[data-idRemoveModal]').on('click', function() {
                    var idEvent = $(this).attr('data-idRemoveModal');
                    $('form').attr('action', '/reserve/delete/'+idEvent);
                });
            })
        });
    })
}
(jQuery);